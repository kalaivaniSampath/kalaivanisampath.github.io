<!DOCTYPE html>
<html>
<head>
  <title>Salesforce OAuth Callback</title>
</head>
<body>
  <h2>Loading Lightning Web Component...</h2>
  <div id="myContainer"></div>

  <script>
    const clientId = 'YOUR_CLIENT_ID';
    const clientSecret = 'YOUR_CLIENT_SECRET';
    const redirectUri = 'https://kalaivanisampath.github.io/oauth-callback.html';

    async function getAccessToken(code) {
      const tokenUrl = 'https://test.salesforce.com/services/oauth2/token';
      const params = new URLSearchParams();
      params.append('grant_type', 'authorization_code');
      params.append('code', code);
      params.append('client_id', clientId);
      params.append('client_secret', clientSecret);
      params.append('redirect_uri', redirectUri);

      const response = await fetch(tokenUrl, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/x-www-form-urlencoded',
        },
        body: params.toString()
      });

      if (!response.ok) {
        throw new Error('Failed to get access token: ' + response.statusText);
      }

      const data = await response.json();
      return data.access_token;
    }

    async function loadLightningOut() {
      const urlParams = new URLSearchParams(window.location.search);
      const code = urlParams.get('code');

      if (!code) {
        document.body.innerHTML = '<p style="color: red;">Missing authorization code in URL.</p>';
        return;
      }

      try {
        const accessToken = await getAccessToken(code);

        const frontdoorUrl = `https://tti-emea--sjdev.sandbox.my.salesforce.com/secur/frontdoor.jsp?sid=${accessToken}`;

        // Load Lightning Out JS
        const script = document.createElement('script');
        script.src = 'https://tti-emea--sjdev.sandbox.my.salesforce.com/lightning/lightning.out.latest/index.iife.prod.js';
        script.onload = () => {
          // Inject the lightning-out-application tag
          const appTag = document.createElement('lightning-out-application');
          appTag.setAttribute('frontdoor-url', frontdoorUrl);
          appTag.setAttribute('components', 'c-ligtningouttwoexample');  // Use your LWC here
          appTag.setAttribute('target', 'myContainer');

          document.body.appendChild(appTag);
        };
        document.head.appendChild(script);

      } catch (error) {
        console.error(error);
        document.body.innerHTML = `<p style="color: red;">Error: ${error.message}</p>`;
      }
    }

    loadLightningOut();
  </script>
</body>
</html>
